{"version":3,"file":"vendor-suspend-react.js","sources":["../node_modules/suspend-react/index.js"],"sourcesContent":["const isPromise = promise => typeof promise === 'object' && typeof promise.then === 'function';\n\nconst globalCache = [];\n\nfunction shallowEqualArrays(arrA, arrB, equal = (a, b) => a === b) {\n  if (arrA === arrB) return true;\n  if (!arrA || !arrB) return false;\n  const len = arrA.length;\n  if (arrB.length !== len) return false;\n\n  for (let i = 0; i < len; i++) if (!equal(arrA[i], arrB[i])) return false;\n\n  return true;\n}\n\nfunction query(fn, keys = null, preload = false, config = {}) {\n  // If no keys were given, the function is the key\n  if (keys === null) keys = [fn];\n\n  for (const entry of globalCache) {\n    // Find a match\n    if (shallowEqualArrays(keys, entry.keys, entry.equal)) {\n      // If we're pre-loading and the element is present, just return\n      if (preload) return undefined; // If an error occurred, throw\n\n      if (Object.prototype.hasOwnProperty.call(entry, 'error')) throw entry.error; // If a response was successful, return\n\n      if (Object.prototype.hasOwnProperty.call(entry, 'response')) {\n        if (config.lifespan && config.lifespan > 0) {\n          if (entry.timeout) clearTimeout(entry.timeout);\n          entry.timeout = setTimeout(entry.remove, config.lifespan);\n        }\n\n        return entry.response;\n      } // If the promise is still unresolved, throw\n\n\n      if (!preload) throw entry.promise;\n    }\n  } // The request is new or has changed.\n\n\n  const entry = {\n    keys,\n    equal: config.equal,\n    remove: () => {\n      const index = globalCache.indexOf(entry);\n      if (index !== -1) globalCache.splice(index, 1);\n    },\n    promise: // Execute the promise\n    (isPromise(fn) ? fn : fn(...keys) // When it resolves, store its value\n    ).then(response => {\n      entry.response = response; // Remove the entry in time if a lifespan was given\n\n      if (config.lifespan && config.lifespan > 0) {\n        entry.timeout = setTimeout(entry.remove, config.lifespan);\n      }\n    }) // Store caught errors, they will be thrown in the render-phase to bubble into an error-bound\n    .catch(error => entry.error = error)\n  }; // Register the entry\n\n  globalCache.push(entry); // And throw the promise, this yields control back to React\n\n  if (!preload) throw entry.promise;\n  return undefined;\n}\n\nconst suspend = (fn, keys, config) => query(fn, keys, false, config);\n\nconst preload = (fn, keys, config) => void query(fn, keys, true, config);\n\nconst peek = keys => {\n  var _globalCache$find;\n\n  return (_globalCache$find = globalCache.find(entry => shallowEqualArrays(keys, entry.keys, entry.equal))) == null ? void 0 : _globalCache$find.response;\n};\n\nconst clear = keys => {\n  if (keys === undefined || keys.length === 0) globalCache.splice(0, globalCache.length);else {\n    const entry = globalCache.find(entry => shallowEqualArrays(keys, entry.keys, entry.equal));\n    if (entry) entry.remove();\n  }\n};\n\nexport { clear, peek, preload, suspend };\n"],"names":["isPromise","promise","globalCache","shallowEqualArrays","arrA","arrB","equal","a","b","len","i","query","fn","keys","preload","config","entry","index","response","error","suspend","clear"],"mappings":"AAAA,MAAMA,EAAYC,GAAW,OAAOA,GAAY,UAAY,OAAOA,EAAQ,MAAS,WAE9EC,EAAc,CAAA,EAEpB,SAASC,EAAmBC,EAAMC,EAAMC,EAAQ,CAACC,EAAGC,IAAMD,IAAMC,EAAG,CACjE,GAAIJ,IAASC,EAAM,MAAO,GAC1B,GAAI,CAACD,GAAQ,CAACC,EAAM,MAAO,GAC3B,MAAMI,EAAML,EAAK,OACjB,GAAIC,EAAK,SAAWI,EAAK,MAAO,GAEhC,QAASC,EAAI,EAAGA,EAAID,EAAKC,IAAK,GAAI,CAACJ,EAAMF,EAAKM,CAAC,EAAGL,EAAKK,CAAC,CAAC,EAAG,MAAO,GAEnE,MAAO,EACT,CAEA,SAASC,EAAMC,EAAIC,EAAO,KAAMC,EAAU,GAAOC,EAAS,GAAI,CAExDF,IAAS,OAAMA,EAAO,CAACD,CAAE,GAE7B,UAAWI,KAASd,EAElB,GAAIC,EAAmBU,EAAMG,EAAM,KAAMA,EAAM,KAAK,EAAG,CAErD,GAAIF,EAAS,OAEb,GAAI,OAAO,UAAU,eAAe,KAAKE,EAAO,OAAO,EAAG,MAAMA,EAAM,MAEtE,GAAI,OAAO,UAAU,eAAe,KAAKA,EAAO,UAAU,EACxD,OAAID,EAAO,UAAYA,EAAO,SAAW,IACnCC,EAAM,SAAS,aAAaA,EAAM,OAAO,EAC7CA,EAAM,QAAU,WAAWA,EAAM,OAAQD,EAAO,QAAQ,GAGnDC,EAAM,SAIf,GAAI,CAACF,EAAS,MAAME,EAAM,OAC3B,CAIH,MAAMA,EAAQ,CACZ,KAAAH,EACA,MAAOE,EAAO,MACd,OAAQ,IAAM,CACZ,MAAME,EAAQf,EAAY,QAAQc,CAAK,EACnCC,IAAU,IAAIf,EAAY,OAAOe,EAAO,CAAC,CAC9C,EACD,SACCjB,EAAUY,CAAE,EAAIA,EAAKA,EAAG,GAAGC,CAAI,GAC9B,KAAKK,GAAY,CACjBF,EAAM,SAAWE,EAEbH,EAAO,UAAYA,EAAO,SAAW,IACvCC,EAAM,QAAU,WAAWA,EAAM,OAAQD,EAAO,QAAQ,EAEhE,CAAK,EACA,MAAMI,GAASH,EAAM,MAAQG,CAAK,CACvC,EAIE,GAFAjB,EAAY,KAAKc,CAAK,EAElB,CAACF,EAAS,MAAME,EAAM,OAE5B,CAEK,MAACI,EAAU,CAACR,EAAIC,EAAME,IAAWJ,EAAMC,EAAIC,EAAM,GAAOE,CAAM,EAE7DD,EAAU,CAACF,EAAIC,EAAME,IAAW,KAAKJ,EAAMC,EAAIC,EAAM,GAAME,CAAM,EAQjEM,EAAQR,GAAQ,CACpB,GAAIA,IAAS,QAAaA,EAAK,SAAW,EAAGX,EAAY,OAAO,EAAGA,EAAY,MAAM,MAAO,CAC1F,MAAMc,EAAQd,EAAY,KAAKc,GAASb,EAAmBU,EAAMG,EAAM,KAAMA,EAAM,KAAK,CAAC,EACrFA,GAAOA,EAAM,QAClB,CACH","x_google_ignoreList":[0]}